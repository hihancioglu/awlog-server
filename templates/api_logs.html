<!DOCTYPE html>
<html>
<head>
    <title>API Logları</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f6f6fa; }
        .container { max-width: 900px; margin-top: 40px; }
        table { font-size: 15px; }
        h2 { margin-bottom: 20px; }
        pre { white-space: pre-wrap; word-break: break-all; margin: 0; }
    </style>
</head>
<body>
<div class="container">
  <div class="d-flex align-items-center mb-3">
    <a class="btn btn-secondary me-3" href="/">Geri Dön</a>
    <h2 class="mb-0">API Logları</h2>
  </div>
  <form method="get" class="mb-3">
    <div class="row mb-2">
      <div class="col">
        <select name="username" class="form-select">
          <option value="">Tüm Kullanıcılar</option>
          {% for u in usernames %}
          <option value="{{ u }}" {% if u == selected_user %}selected{% endif %}>{{ u }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col">
        <select name="endpoint" class="form-select">
          <option value="">Tüm Endpointler</option>
          {% for e in endpoints %}
          <option value="{{ e }}" {% if e == selected_endpoint %}selected{% endif %}>{{ e }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="row mb-2">
      <div class="col">
        <input type="text" name="q" class="form-control" placeholder="Ara" value="{{ q }}">
      </div>
      <div class="col">
        <input type="datetime-local" name="start" class="form-control" value="{{ start }}">
      </div>
      <div class="col">
        <input type="datetime-local" name="end" class="form-control" value="{{ end }}">
      </div>
    </div>
    <div class="row mb-2">
      <div class="col">
        <select name="field" class="form-select">
          <option value="">Payload Alanı</option>
          {% for f in payload_fields %}
          <option value="{{ f }}" {% if f == field %}selected{% endif %}>{{ f }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col">
        <input type="text" name="value" class="form-control" placeholder="Değer" value="{{ value }}">
      </div>
      <div class="col">
        <button class="btn btn-primary w-100" type="submit">Filtrele</button>
      </div>
    </div>
  </form>
  <table class="table table-bordered table-striped shadow">
    <thead class="table-dark">
      <tr>
        <th>Zaman</th>
        <th>Endpoint</th>
        <th>Kullanıcı</th>
        <th>Hostname</th>
        <th>Payload</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr>
        <td>{{ log.created_at | local_time }}</td>
        <td>{{ log.endpoint }}</td>
        <td>{{ log.username }}</td>
        <td>{{ log.hostname }}</td>
        <td><pre>{{ log.payload }}</pre></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</body>
</html>
